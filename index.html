<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <!-- Đặt viewport cố định để hiển thị giao diện PC trên mọi thiết bị -->
    <meta name="viewport" content="width=1024">
    <!-- Meta tags tối ưu hiệu suất -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <meta http-equiv="Cache-Control" content="max-age=31536000, immutable">
    <meta name="description" content="Tự xây dựng cấu hình PC với công cụ TRUONG PHAT COMPUTER - Chọn linh kiện máy tính phù hợp nhu cầu và ngân sách">
    
    <title>BUILD PC TRUONG PHAT COMPUTER - Chọn Linh Kiện Máy Tính</title>
    
    <!-- DNS Prefetch và Preconnect -->
    <link rel="dns-prefetch" href="https://cdn.sheetjs.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://unpkg.com">
    
    <link rel="preconnect" href="https://cdn.sheetjs.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    
    <!-- Preload CSS quan trọng -->
    <link rel="preload" href="./buildsan.css" as="style">
    <link rel="preload" href="./styles.css" as="style">
    
    <!-- Thư viện XLSX - Nhất định phải tải trước các script khác -->
    <script src="https://cdn.sheetjs.com/xlsx-0.18.9/package/dist/xlsx.full.min.js" defer></script>
    
    <!-- CSS chính -->
    <link rel="stylesheet" href="./buildsan.css">
    <link rel="stylesheet" href="./styles.css">
    
    <!-- Fix CSS để giải quyết vấn đề giao diện -->
    <link rel="stylesheet" href="./fix-styles.css">
    
    <!-- Chỉ load font awesome icons cần thiết thay vì toàn bộ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- Progressive Web App -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#222831">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="./images/icon-192.png">
    
    <!-- CSS cho modal/popup -->
    <link rel="stylesheet" href="./modal-styles.css" media="print" onload="this.media='all'">
    
    <!-- Animation library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload="this.media='all'">
    
    <!-- Fix CSS Layout -->
    <style>
        /* Reset header styling to match first image */
        header {
            background: linear-gradient(135deg, #0053b4, #0275d8);
            padding: 15px 0;
        }
        
        /* Logo styling */
        header .logo {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
        }
        
        /* Fix main container layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Fix navigation items */
        .nav-items {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .nav-item {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .nav-item.active {
            background-color: #007bff;
            color: white;
        }
        
        /* Fix budget range slider */
        .budget-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* CPU selection styling */
        .cpu-selection {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .cpu-options {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .cpu-option {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        
        .cpu-option.selected {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
        }
        
        /* Game selection styling */
        .game-selection {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        /* Fix dark mode toggle */
        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        /* Ensure main game cards look correct */
        .game-card {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            height: 150px;
        }
        
        .game-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .game-title {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
        }
        
        /* Fix for configuration tables */
        #component-table, #configuration-table, .config-table {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Style fixes for tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        /* Fix for modal windows */
        .modal-content {
            display: block !important;
        }
    </style>
    
    <!-- Service Worker Registration -->
    <script>
        // Đăng ký Service Worker nếu trình duyệt hỗ trợ
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Lấy đường dẫn cơ sở của ứng dụng (để hỗ trợ GitHub Pages)
                const basePath = location.pathname.substring(0, location.pathname.lastIndexOf('/') + 1);
                
                navigator.serviceWorker.register('./service-worker.js', { scope: basePath })
                    .then(registration => {
                        console.log('Service Worker đã đăng ký thành công:', registration);
                    })
                    .catch(error => {
                        console.error('Lỗi đăng ký Service Worker:', error);
                    });
            });
        }
        
        // Đảm bảo rằng các bảng cấu hình hiển thị đúng
        document.addEventListener('DOMContentLoaded', function() {
            // Force show configuration tables after page load
            setTimeout(function() {
                const tables = document.querySelectorAll('#component-table, #configuration-table, .config-table');
                tables.forEach(table => {
                    if (table) {
                        table.style.display = 'block';
                        table.style.visibility = 'visible';
                        table.style.opacity = '1';
                    }
                });
                
                // Kiểm tra trạng thái các button
                const calculateBtn = document.querySelector('#calculate-btn, .calculate-btn, button[onclick*="showConfig"]');
                if (calculateBtn) {
                    calculateBtn.click();
                }
                
                console.log('Config table display set to block on page load');
            }, 1500);
        });
    </script>

    <style id="force-display-styles">
    /* Force display of all tables and components - but NOT modals */
    table, #component-table, #configuration-table, .config-table, .component-table,
    .table-container, .table-responsive, .component-selection-container, .config-section {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
    }

    /* Ensure tables display as tables */
    table {
        display: table !important;
        width: 100% !important;
        border-collapse: collapse !important;
    }

    tr {
        display: table-row !important;
    }

    td, th {
        display: table-cell !important;
        padding: 8px !important;
        border: 1px solid #ddd !important;
    }

    /* Don't force modal visibility - allow them to be toggled properly */
    .modal, .modal-content, .modal-body, #configuration-detail-modal {
        /* Remove the forced display */
        display: none;
    }
    </style>
</head>

<body>
    <!-- Add a button at the top of the page -->
    <div style="position: fixed; top: 10px; left: 10px; z-index: 9999;">
        <button id="force-show-tables" style="background-color: #ff5722; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;">
            Hiển thị cấu hình
        </button>
        <button id="toggle-debug" style="background-color: #2196F3; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-left: 10px;">
            Debug
        </button>
    </div>

    <script>
    // Add click handler to force show tables button
    document.addEventListener('DOMContentLoaded', function() {
        const forceShowButton = document.getElementById('force-show-tables');
        if (forceShowButton) {
            forceShowButton.addEventListener('click', function() {
                // Find the configuration table
                const configTable = document.querySelector('#config-table, .config-table');
                if (configTable) {
                    // Only make the table visible
                    configTable.style.display = 'table';
                    configTable.style.visibility = 'visible';
                    configTable.style.opacity = '1';
                    
                    // Scroll to it
                    configTable.scrollIntoView({behavior: 'smooth'});
                }
                
                // Trigger calculate buttons if table not found
                if (!configTable) {
                    const calculateButtons = document.querySelectorAll('#calculate-btn, .calculate-btn, button[onclick*="showConfig"]');
                    calculateButtons.forEach(button => {
                        if (button && typeof button.click === 'function') {
                            try {
                                button.click();
                            } catch (err) {}
                        }
                    });
                }
                
                // Try calling showConfigDetailModal function to show detailed configuration
                try {
                    if (typeof window.showConfigDetailModal === 'function') {
                        window.showConfigDetailModal();
                    }
                } catch (err) {
                    console.error('Error calling showConfigDetailModal:', err);
                }
            });
        }
        
        // Toggle debug panel visibility
        const toggleDebugButton = document.getElementById('toggle-debug');
        const debugHelper = document.getElementById('debug-helper');
        
        if (toggleDebugButton && debugHelper) {
            // Initially hide debug panel
            debugHelper.style.display = 'none';
            
            toggleDebugButton.addEventListener('click', function() {
                if (debugHelper.style.display === 'none') {
                    debugHelper.style.display = 'block';
                    debugHelper(); // Update debug info immediately
                } else {
                    debugHelper.style.display = 'none';
                }
            });
        }
    });
    </script>

    <header>
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-desktop fa-spin"></i>
                <span>TRUONG PHAT COMPUTER</span>
            </div>
            <button id="dark-mode-toggle" title="Chuyển chế độ sáng/tối" style="margin-left:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:#fff;"><i class="fas fa-moon"></i></button>
        </div>
        <div class="contact-buttons">
            <a href="https://zalo.me/0836768597" target="_blank" class="contact-button">
                <i class="fab fa-zalo"></i> Liên hệ qua Zalo
            </a>
            <div class="phone-number">
                <a href="tel:0836768597">
                    <i class="fas fa-phone-alt"></i>
                    <span>0836768597</span>
                </a>
            </div>
            <a href="https://www.facebook.com/tpcom.hb" target="_blank" class="contact-button">
                <i class="fab fa-facebook"></i> Liên hệ qua Facebook
            </a>
        </div>
    </header>

    <div class="main-container">
        <div class="page-title">
            <h1><i class="fas fa-tools"></i> XÂY DỰNG CẤU HÌNH PC <i class="fas fa-tools"></i></h1>
            <p class="subtitle">Tùy chỉnh theo nhu cầu và ngân sách của bạn</p>
        </div>

        <div class="container">
            <div class="build-progress">
                <div class="progress-step active" data-step="1">
                    <div class="step-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div class="step-label">Ngân sách</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="step-icon"><i class="fas fa-microchip"></i></div>
                    <div class="step-label">CPU</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="step-icon"><i class="fas fa-gamepad"></i></div>
                    <div class="step-label">Game</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="step-icon"><i class="fas fa-laptop-code"></i></div>
                    <div class="step-label">Linh kiện</div>
                </div>
                <div class="progress-step" data-step="5">
                    <div class="step-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="step-label">Hoàn thành</div>
                </div>
            </div>

            <!-- Phần tầm tiền -->
            <section id="budget-range-selection" class="selection-section accent-section">
                <div class="section-header">
                    <i class="fas fa-money-bill-wave"></i>
                    <h2>Chọn Cấu Hình Tầm Tiền Mong Muốn</h2>
                </div>
                <div class="slider-container">
                    <div class="slider-value-container">
                        <span id="budget-value-min">3 triệu</span>
                        <span id="budget-value" class="budget-value-current">3 triệu</span>
                        <span id="budget-value-max">30 triệu</span>
                    </div>
                    <input type="range" id="budget-range" min="3000000" max="30000000" step="1000000" value="3000000" class="slider">
                    <div class="slider-ticks">
                        <span>3M</span>
                        <span>10M</span>
                        <span>20M</span>
                        <span>30M</span>
                    </div>
                </div>
            </section>

            <!-- Phần chọn loại CPU -->
            <section id="cpu-type-selection" class="selection-section accent-section">
                <div class="section-header">
                    <i class="fas fa-microchip"></i>
                    <h2>Chọn Loại CPU</h2>
                </div>
                <div class="cpu-brand-selection">
                    <div class="brand-option" id="intel-option" onclick="handleCpuSelection('Intel')">
                        <div class="brand-logo">
                            <img src="images/intel.jpg" alt="Intel Logo" style="height:48px;width:auto;object-fit:contain;" onerror="this.style.display='none';this.parentNode.innerHTML='<i class=\'fab fa-intel\'></i>'">
                        </div>
                        <div class="brand-name">INTEL</div>
                    </div>
                    <div class="brand-option" id="amd-option" onclick="handleCpuSelection('Amd')">
                        <div class="brand-logo">
                            <img src="images/amd.jpg" alt="AMD Logo" style="height:48px;width:auto;object-fit:contain;" onerror="this.style.display='none';this.parentNode.innerHTML='<i class=\'fab fa-amd\'></i>'">
                        </div>
                        <div class="brand-name">AMD</div>
                    </div>
                </div>
                <select id="cpu-type" name="cpu-type" class="dropdown hidden-dropdown" required>
                    <option value="Intel">INTEL</option>
                    <option value="Amd">AMD</option>
                </select>
            </section>

            <!-- Inline script để đảm bảo sự kiện click luôn hoạt động -->
            <script>
                function handleCpuSelection(type) {
                    console.log('Direct CPU selection click:', type);
                    
                    // Update visual UI immediately
                    const intelOption = document.getElementById('intel-option');
                    const amdOption = document.getElementById('amd-option');
                    const cpuTypeDropdown = document.getElementById('cpu-type');
                    
                    if (type === 'Intel') {
                        intelOption.classList.add('selected');
                        amdOption.classList.remove('selected');
                        if (cpuTypeDropdown) cpuTypeDropdown.value = 'Intel';
                    } else {
                        amdOption.classList.add('selected');
                        intelOption.classList.remove('selected');
                        if (cpuTypeDropdown) cpuTypeDropdown.value = 'Amd';
                    }
                    
                    // Trigger CPU-type change event
                    if (cpuTypeDropdown) {
                        cpuTypeDropdown.dispatchEvent(new Event('change'));
                    }
                    
                    // Use a small timeout to ensure event-handlers.js has loaded
                    setTimeout(() => {
                        // Call the global handler function if available
                        if (typeof window.handleCpuTypeSelection === 'function') {
                            console.log('Calling global handleCpuTypeSelection with:', type);
                            window.handleCpuTypeSelection(type);
                        } else {
                            console.warn('Global handleCpuTypeSelection function not found! Using fallback...');
                            
                            // Fallback: Apply basic UI changes
                            document.body.setAttribute('data-selected-cpu-type', type);
                            document.body.setAttribute('data-current-cpu-type', type);
                            
                            // Create permanent indicator
                            const existingIndicator = document.getElementById('permanent-cpu-indicator');
                            if (existingIndicator) existingIndicator.remove();
                            
                            const cpuIndicator = document.createElement('div');
                            cpuIndicator.style.position = 'fixed';
                            cpuIndicator.style.bottom = '20px';
                            cpuIndicator.style.right = '20px';
                            cpuIndicator.style.padding = '15px 20px';
                            cpuIndicator.style.backgroundColor = type === 'Intel' ? '#0071c5' : '#ED1C24';
                            cpuIndicator.style.color = 'white';
                            cpuIndicator.style.fontWeight = 'bold';
                            cpuIndicator.style.fontSize = '18px';
                            cpuIndicator.style.zIndex = '10000';
                            cpuIndicator.style.borderRadius = '5px';
                            cpuIndicator.style.boxShadow = '0 0 15px rgba(0,0,0,0.5)';
                            cpuIndicator.id = 'permanent-cpu-indicator';
                            cpuIndicator.textContent = `${type.toUpperCase()} MODE`;
                            document.body.appendChild(cpuIndicator);
                            
                            // Try to reload config with selected CPU
                            try {
                                const gameId = document.getElementById('game-genre')?.value;
                                const budget = parseInt(document.getElementById('budget-range')?.value);
                                if (typeof window.autoSelectConfig === 'function' && gameId && budget) {
                                    window.autoSelectConfig(gameId, budget, type);
                                }
                            } catch (e) {
                                console.error('Error in fallback config selection:', e);
                            }
                        }
                    }, 100);
                }
                
                // Thêm CSS động để làm nổi bật nút được chọn
                const style = document.createElement('style');
                style.textContent = `
                    .brand-option {
                        cursor: pointer !important;
                        transition: all 0.3s ease;
                        border: 3px solid transparent;
                        position: relative;
                        z-index: 5;
                    }
                    .brand-option:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    }
                    .brand-option.selected {
                        border-color: #4CAF50;
                        box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
                    }
                    #intel-option.selected {
                        border-color: #0071c5;
                        box-shadow: 0 0 15px rgba(0, 113, 197, 0.5);
                    }
                    #amd-option.selected {
                        border-color: #ED1C24;
                        box-shadow: 0 0 15px rgba(237, 28, 36, 0.5);
                    }
                    .brand-option::after {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        z-index: 10;
                    }
                `;
                document.head.appendChild(style);
                
                // Handle direct clicks with redundant event listeners
                document.addEventListener('DOMContentLoaded', function() {
                    // Add redundant click handlers to ensure clicks work
                    document.querySelectorAll('#intel-option, #amd-option').forEach(el => {
                        el.addEventListener('click', function(e) {
                            const type = this.id === 'intel-option' ? 'Intel' : 'Amd';
                            console.log(`Extra click handler for ${type} activated`);
                            handleCpuSelection(type);
                            e.preventDefault();
                            e.stopPropagation();
                        });
                    });
                    
                    // Set a hard-coded click handler on document
                    document.addEventListener('click', function(e) {
                        const intelOption = document.getElementById('intel-option');
                        const amdOption = document.getElementById('amd-option');
                        
                        if (e.target && (e.target === intelOption || intelOption.contains(e.target))) {
                            console.log('Document-level Intel click detected');
                            handleCpuSelection('Intel');
                        } else if (e.target && (e.target === amdOption || amdOption.contains(e.target))) {
                            console.log('Document-level AMD click detected');
                            handleCpuSelection('Amd');
                        }
                    });
                });
            </script>

            <!-- Phần chọn game -->
            <section id="game-selection" class="selection-section accent-section">
                <div class="section-header">
                    <i class="fas fa-gamepad"></i>
                    <h2>Chọn Game Muốn Chơi</h2>
                </div>
                <div class="game-grid">
                    <div class="game-card" data-game="valorant">
                        <div class="game-image" style="background-image: url('images/valorant.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Valorant</div>
                    </div>
                    <div class="game-card" data-game="csgo">
                        <div class="game-image" style="background-image: url('images/csgo.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">CS:GO</div>
                    </div>
                    <div class="game-card" data-game="pubg">
                        <div class="game-image" style="background-image: url('images/pubg.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">PUBG</div>
                    </div>
                    <div class="game-card" data-game="lol">
                        <div class="game-image" style="background-image: url('images/lol.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Liên Minh Huyền Thoại</div>
                    </div>
                    <div class="game-card" data-game="gta-v">
                        <div class="game-image" style="background-image: url('images/gta-v.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">GTA V</div>
                    </div>
                    <div class="game-card" data-game="elden-ring">
                        <div class="game-image" style="background-image: url('images/elden-ring.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Elden Ring</div>
                    </div>
                    <div class="game-card" data-game="naraka">
                        <div class="game-image" style="background-image: url('images/naraka.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Naraka: Bladepoint</div>
                    </div>
                    <div class="game-card" data-game="genshin">
                        <div class="game-image" style="background-image: url('images/genshin.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Genshin Impact</div>
                    </div>
                    <div class="game-card" data-game="fo4">
                        <div class="game-image" style="background-image: url('images/fo4.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">FIFA Online 4</div>
                    </div>
                    <div class="game-card" data-game="black-myth-wukong">
                        <div class="game-image" style="background-image: url('images/black-myth-wukong.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Black Myth: Wukong</div>
                    </div>
                    <div class="game-card" data-game="god-of-war">
                        <div class="game-image" style="background-image: url('images/god-of-war.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">God of War</div>
                    </div>
                    <div class="game-card" data-game="battle-teams-2">
                        <div class="game-image" style="background-image: url('images/battle-teams-2.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Battle Teams 2</div>
                    </div>
                    <div class="game-card" data-game="delta-force">
                        <div class="game-image" style="background-image: url('images/delta-force.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Delta Force</div>
                    </div>
                    <div class="game-card" data-game="audition">
                        <div class="game-image" style="background-image: url('images/audition.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">Audition</div>
                    </div>
                    <div class="game-card" data-game="mu-origin">
                        <div class="game-image" style="background-image: url('images/mu-origin.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">MU Origin</div>
                    </div>
                    <div class="game-card" data-game="crossfire">
                        <div class="game-image" style="background-image: url('images/crossfire.jpg'); background-size: cover; background-position: center; height: 100px;"></div>
                        <div class="game-name">CrossFire</div>
                    </div>
                </div>
                <select id="game-genre" name="game-genre" class="dropdown hidden-dropdown" required>
                    <option value="">Chọn game</option>
                    <option value="valorant">Valorant</option>
                    <option value="csgo">CS:GO</option>
                    <option value="pubg">PUBG</option>
                    <option value="lol">Liên Minh Huyền Thoại (LOL)</option>
                    <option value="gta-v">GTA V</option>
                    <option value="elden-ring">Elden Ring</option>
                    <option value="naraka">Naraka: Bladepoint</option>
                    <option value="genshin">Genshin Impact</option>
                    <option value="fo4">FIFA Online 4</option>
                    <option value="black-myth-wukong">Black Myth: Wukong</option>
                    <option value="god-of-war">God of War</option>
                    <option value="battle-teams-2">Battle Teams 2</option>
                    <option value="delta-force">Delta Force</option>
                    <option value="audition">Audition</option>
                    <option value="mu-origin">MU Origin</option>
                    <option value="crossfire">CrossFire</option>
                </select>
                
                <div class="auto-select-container" style="margin-top: 20px; text-align: center;">
                    <button id="manual-auto-select" class="action-button primary-btn" style="display: inline-block; padding: 10px 20px;">
                        <i class="fas fa-magic"></i> Tự Động Chọn Cấu Hình
                    </button>
                </div>
            </section>

            <section id="component-selection" class="selection-section">
                <div class="section-header">
                    <i class="fas fa-laptop-code"></i>
                    <h2>Lựa Chọn Linh Kiện Chính</h2>
                </div>
                <div class="container">
                    <div id="socket-message" class="warning-message" style="display: none; margin: 10px 0; padding: 10px; background-color: #fff3cd; border-radius: 5px; color: #856404;"></div>
                    <div class="components-grid">
                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-microchip"></i>
                                <h3>CPU</h3>
                                <div class="compatibility-icon" id="cpu-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="cpu" name="cpu" class="dropdown">
                                <option value="" disabled selected>Chọn CPU</option>
                            </select>
                            <div class="component-info-hover" id="cpu-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-server"></i>
                                <h3>Mainboard</h3>
                                <div class="compatibility-icon" id="mainboard-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="mainboard" name="mainboard" class="dropdown">
                                <option value="" disabled selected>Chọn Mainboard</option>
                            </select>
                            <div class="component-info-hover" id="mainboard-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-tv"></i>
                                <h3>Card Đồ Họa (VGA)</h3>
                                <div class="compatibility-icon" id="vga-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="vga" name="vga" class="dropdown">
                                <option value="" disabled selected>Chọn VGA</option>
                            </select>
                            <div class="component-info-hover" id="vga-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-memory"></i>
                                <h3>RAM</h3>
                                <div class="compatibility-icon" id="ram-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="ram" name="ram" class="dropdown">
                                <option value="" disabled selected>Chọn RAM</option>
                            </select>
                            <div class="component-info-hover" id="ram-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-hdd"></i>
                                <h3>Ổ Cứng SSD</h3>
                                <div class="compatibility-icon" id="ssd-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="ssd" name="ssd" class="dropdown">
                                <option value="" disabled selected>Chọn SSD</option>
                            </select>
                            <div class="component-info-hover" id="ssd-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-bolt"></i>
                                <h3>Nguồn (PSU)</h3>
                                <div class="compatibility-icon" id="psu-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="psu" name="psu" class="dropdown">
                                <option value="" disabled selected>Chọn PSU</option>
                            </select>
                            <div class="component-info-hover" id="psu-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-cube"></i>
                                <h3>Vỏ Case</h3>
                                <div class="compatibility-icon" id="case-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="case" name="case" class="dropdown">
                                <option value="" disabled selected>Chọn Case</option>
                            </select>
                            <div class="component-info-hover" id="case-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-wind"></i>
                                <h3>Tản Nhiệt CPU</h3>
                                <div class="compatibility-icon" id="cpuCooler-compatibility"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <select id="cpuCooler" name="cpuCooler" class="dropdown">
                                <option value="" disabled selected>Chọn Tản Nhiệt CPU</option>
                            </select>
                            <div class="component-info-hover" id="cpuCooler-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="additional-selection" class="selection-section">
                <div class="section-header">
                    <i class="fas fa-plus-circle"></i>
                    <h2>Lựa Chọn Thêm (Tùy Chọn)</h2>
                </div>
                <div class="container">
                    <div class="components-grid">
                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-database"></i>
                                <h3>HDD</h3>
                            </div>
                            <select id="hdd" name="hdd" class="dropdown">
                                <option value="" disabled selected>Chọn HDD</option>
                            </select>
                            <div class="component-info-hover" id="hdd-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>

                        <div class="component">
                            <div class="component-header">
                                <i class="fas fa-desktop"></i>
                                <h3>Màn Hình</h3>
                            </div>
                            <select id="monitor" name="monitor" class="dropdown">
                                <option value="" disabled selected>Chọn Màn Hình</option>
                            </select>
                            <div class="component-info-hover" id="monitor-info">
                                <div class="specs-preview"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="selected-components">
                <div class="section-header">
                    <i class="fas fa-list-check"></i>
                    <h2>Linh kiện đã chọn</h2>
                </div>
                <div id="selected-components-list" class="selected-components-grid"></div>
            </section>

            <div id="compatibility-alert" class="compatibility-alert hidden">
                <i class="fas fa-exclamation-triangle"></i>
                <div class="alert-message" id="compatibility-message"></div>
                <button id="close-alert" class="close-alert"><i class="fas fa-times"></i></button>
            </div>

            <div id="summary-modal" class="modal" style="display:block">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-clipboard-list"></i> Cấu hình chi tiết</h2>
                        <span class="close-modal">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div id="modal-components-list"></div>
                        <div id="modal-total-price">Tổng cộng: 0 VNĐ</div>
                        <div id="image-preview-container"></div>
                        <div class="share-options">
                            <button id="share-facebook" class="share-button"><i class="fab fa-facebook"></i> Chia sẻ Facebook</button>
                            <button id="copy-link" class="share-button"><i class="fas fa-link"></i> Sao chép liên kết</button>
                            <button id="download-config" class="share-button luu-cau-hinh"><i class="fas fa-download"></i> Tải cấu hình</button>
                        </div>
                    </div>
                </div>
            </div>

            <section id="total-price" class="total-price">
                <h2>Tổng Tiền Dự Kiến</h2>
                <p>0 VNĐ</p>
                <div class="price-breakdown">
                    <button id="view-breakdown" class="view-breakdown-btn"><i class="fas fa-receipt"></i> Xem chi tiết</button>
                </div>
            </section>

            <!-- New button to show configuration tables -->
            <div style="text-align: center; margin: 20px 0;">
                <button id="show-all-config-tables" style="background-color: #2196F3; color: white; padding: 12px 24px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                    <i class="fas fa-table"></i> HIỂN THỊ BẢNG CẤU HÌNH CHI TIẾT
                </button>
            </div>

            <div class="button-group">
                <button type="button" class="action-button secondary-btn" id="reset-button">
                    <i class="fas fa-redo"></i> Làm mới
                </button>
                <button type="button" class="action-button primary-btn" id="calculate-button">
                    <i class="fas fa-clipboard-check"></i> XEM CHI TIẾT VÀ ĐÁNH GIÁ
                </button>
                <button type="button" class="action-button accent-btn luu-cau-hinh" id="save-button">
                    <i class="fas fa-save"></i> Lưu cấu hình
                </button>
            </div>
            
            <!-- Bảng chi tiết cấu hình -->
            <div id="config-table" class="config-table force-visible" style="display:table !important; visibility:visible !important; opacity:1 !important; margin: 20px auto; max-width: 90%; overflow-x: auto; background-color: white; box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 8px;">
                <h2 style="text-align: center; color: var(--primary-color); margin: 15px 0; font-size: 24px;"><i class="fas fa-clipboard-list"></i> BẢNG CHI TIẾT CẤU HÌNH MÁY TÍNH</h2>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <thead>
                        <tr style="background-color: #2196F3; color: white;">
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">STT</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">HÌNH ẢNH</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">TÊN, MÃ, LOẠI LINH KIỆN</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">ĐVT</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">SỐ LƯỢNG</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">ĐƠN GIÁ</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">THÀNH TIỀN</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">BẢO HÀNH</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">GHI CHÚ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background-color: #f9f9f9;">
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="cpu-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="cpu-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="cpu-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="cpu-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">36T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">2</td>
                            <td id="mainboard-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="mainboard-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="mainboard-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="mainboard-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">36T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">3</td>
                            <td id="ram-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="ram-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="ram-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="ram-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">36T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">4</td>
                            <td id="vga-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="vga-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="vga-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="vga-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">3T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">5</td>
                            <td id="ssd-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="ssd-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="ssd-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="ssd-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">36T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">6</td>
                            <td id="cpu-cooler-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="cpu-cooler-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="cpu-cooler-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="cpu-cooler-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">12T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">7</td>
                            <td id="psu-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="psu-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="psu-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="psu-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">36T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">8</td>
                            <td id="case-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="case-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="case-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="case-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">12T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">9</td>
                            <td id="hdd-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="additional-component-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="additional-component-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="additional-component-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">12T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">10</td>
                            <td id="monitor-image" style="padding: 10px; text-align: center; border: 1px solid #ddd;"></td>
                            <td id="monitor-name" style="padding: 10px; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">Chiếc</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">1</td>
                            <td id="monitor-price" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td id="monitor-total" style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">36T</td>
                            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">NEW</td>
                        </tr>
                        <tr>
                            <td colspan="6" style="text-align: right; padding: 10px; border: 1px solid #ddd;"><strong>Tổng cộng</strong></td>
                            <td id="total-price-cell" style="padding: 10px; text-align: right; font-weight: bold; color: #f44336; border: 1px solid #ddd;">0</td>
                            <td colspan="2" style="border: 1px solid #ddd;"></td>
                        </tr>
                        <tr>
                            <td colspan="6" style="text-align: right; padding: 10px; border: 1px solid #ddd;"><strong>Chiết khấu</strong></td>
                            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td colspan="2" style="border: 1px solid #ddd;"></td>
                        </tr>
                        <tr>
                            <td colspan="6" style="text-align: right; padding: 10px; border: 1px solid #ddd;"><strong>Đã thanh toán</strong></td>
                            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;"></td>
                            <td colspan="2" style="border: 1px solid #ddd;"></td>
                        </tr>
                        <tr>
                            <td colspan="6" style="text-align: right; padding: 10px; border: 1px solid #ddd;"><strong>Còn lại</strong></td>
                            <td id="remaining-price-cell" style="padding: 10px; text-align: right; font-weight: bold; color: #f44336; border: 1px solid #ddd;">0</td>
                            <td colspan="2" style="border: 1px solid #ddd;"></td>
                        </tr>
                    </tbody>
                </table>
                <div class="button-group" style="margin-top: 20px; text-align: center;">
                    <button id="refresh-table" class="action-button primary-btn" style="display: inline-block; padding: 10px 20px; margin: 0 10px;">
                        <i class="fas fa-sync-alt"></i> Cập Nhật Bảng
                    </button>
                    <button id="show-config-details" class="action-button accent-btn" style="display: inline-block; padding: 10px 20px; margin: 0 10px;">
                        <i class="fas fa-search-plus"></i> Chi Tiết Cấu Hình
                    </button>
                </div>
                <div id="socket-message" class="system-message" style="margin: 15px; padding: 10px; background-color: #e7f3fe; border: 1px solid #b6dcfe; color: #0c5460; border-radius: 5px;"></div>
                <div id="score-message" class="system-message" style="margin: 15px; padding: 10px; background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; border-radius: 5px;"></div>
                <div id="upgrade-message" class="system-message" style="margin: 15px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; border-radius: 5px;"></div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <i class="fas fa-desktop"></i> TRUONG PHAT COMPUTER
            </div>
            <div class="footer-contact">
                <div><i class="fas fa-map-marker-alt"></i> Địa chỉ: Hòa Bình, Việt Nam</div>
                <div><i class="fas fa-phone"></i> Hotline: 0836768597</div>
                <div><i class="fas fa-envelope"></i> Email: contact@truongphatcomputer.com</div>
            </div>
            <div class="footer-social">
                <a href="https://www.facebook.com/tpcom.hb" target="_blank"><i class="fab fa-facebook"></i></a>
                <a href="#" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="#" target="_blank"><i class="fab fa-tiktok"></i></a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 BUILD PC TRUONG PHAT COMPUTER. All rights reserved.</p>
        </div>
    </footer>

    <div id="to-top-button" class="to-top-button">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Script for the interactive PC builder -->
    <script src="./components-data.js"></script>
    <script src="./buildsan.js" type="module"></script>
    <!-- Script for Excel export functionality -->
    <script src="./auto-export-config.js"></script>
    <!-- Script for enhanced auto-config functionality -->
    <script src="./auto-config-helper.js"></script>
    
    <!-- Tải trình tải dữ liệu linh kiện -->
    <script src="./import-loader.js" type="module"></script>
    
    <script>
        // Load required libraries
        function loadRequiredLibraries() {
            return new Promise((resolve, reject) => {
                // Load Popper.js
                if (typeof window.Popper === 'undefined') {
                    const popperScript = document.createElement('script');
                    popperScript.src = 'https://unpkg.com/@popperjs/core@2.11.8/dist/umd/popper.min.js';
                    popperScript.onload = () => {
                        console.log('Popper.js loaded successfully');
                        resolve();
                    };
                    popperScript.onerror = () => reject(new Error('Failed to load Popper.js'));
                    document.head.appendChild(popperScript);
                } else {
                    resolve();
                }
            });
        }

        // Hàm populateDropdowns
        function populateDropdowns() {
            console.log('Initializing dropdowns...');
            try {
                // Lấy các dropdown
                const componentDropdowns = {
                    'cpu': document.getElementById('cpu'),
                    'mainboard': document.getElementById('mainboard'),
                    'vga': document.getElementById('vga'),
                    'ram': document.getElementById('ram'),
                    'ssd': document.getElementById('ssd'),
                    'psu': document.getElementById('psu'),
                    'case': document.getElementById('case'),
                    'cpuCooler': document.getElementById('cpuCooler'),
                    'hdd': document.getElementById('hdd'),
                    'monitor': document.getElementById('monitor')
                };
                
                // Lấy dữ liệu từ window object
                const componentsData = {
                    'cpu': window.cpuData || {},
                    'mainboard': window.mainboardData || {},
                    'vga': window.vgaData || {},
                    'ram': window.ramData || {},
                    'ssd': window.ssdData || {},
                    'psu': window.psuData || {},
                    'case': window.caseData || {},
                    'cpuCooler': window.cpuCoolerData || {},
                    'hdd': window.hddData || {},
                    'monitor': window.monitorData || {}
                };
                
                // Thêm options cho mỗi dropdown từ dữ liệu tương ứng
                Object.keys(componentDropdowns).forEach(componentType => {
                    const dropdown = componentDropdowns[componentType];
                    const data = componentsData[componentType];
                    
                    if (dropdown && data && Object.keys(data).length > 0 && dropdown.options.length <= 1) {
                        // Xóa tất cả options hiện tại trừ option đầu tiên (thường là placeholder)
                        const placeholderOption = dropdown.options[0];
                        dropdown.innerHTML = '';
                        if (placeholderOption) {
                            dropdown.appendChild(placeholderOption);
                        }
                        
                        // Thêm options mới từ dữ liệu
                        Object.keys(data).forEach(key => {
                            const component = data[key];
                            const option = document.createElement('option');
                            option.value = key;
                            option.text = `${component.name} - ${formatPrice(component.price)} VNĐ`;
                            option.dataset.price = component.price;
                            option.dataset.image = component.image;
                            dropdown.appendChild(option);
                        });
                        
                        console.log(`Added ${Object.keys(data).length} options to ${componentType} dropdown`);
                    }
                });
                
                console.log('Dropdowns populated successfully');
            } catch (error) {
                console.error('Error in populateDropdowns:', error);
            }
        }
        
        // Helper function to format price
        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await loadRequiredLibraries();
                
                // Lắng nghe sự kiện dữ liệu đã được tải
                document.addEventListener('component-data-loaded', () => {
                    console.log('Nhận được sự kiện component-data-loaded, đang điền dữ liệu vào dropdowns');
                    populateDropdowns();
                });
                
                // REMOVED: Don't hide the config table initially
                
                // Register event listener for the calculate button
                const calculateButton = document.getElementById('calculate-button');
                const summaryModal = document.getElementById('summary-modal');
                
                if (calculateButton) {
                    calculateButton.addEventListener('click', function() {
                        console.log('Calculate button clicked - showing detailed configuration modal');
                        // Reset closed state
                        window.userClosedConfigModal = false;
                        // Populate and display the detailed configuration modal
                        if (typeof window.showConfigDetailModal === 'function') {
                            window.showConfigDetailModal();
                        } else if (summaryModal) {
                            summaryModal.style.display = 'block';
                        }
                    });
                }
                
                // Add event handler for the show-config-details button
                const showConfigDetailsButton = document.getElementById('show-config-details');
                if (showConfigDetailsButton) {
                    showConfigDetailsButton.addEventListener('click', function() {
                        console.log('Show details button clicked - displaying detailed configuration modal');
                        if (typeof window.showConfigDetailModal === 'function') {
                            window.showConfigDetailModal();
                        } else if (summaryModal) {
                            summaryModal.style.display = 'block';
                        }
                    });
                }
                
                // Add event handler for closing the modal
                const closeModal = document.querySelector('.close-modal');
                if (closeModal && summaryModal) {
                    closeModal.addEventListener('click', function() {
                        summaryModal.style.display = 'none';
                    });
                }
                
                // Close modal when clicking outside
                window.addEventListener('click', function(event) {
                    if (event.target == summaryModal) {
                        summaryModal.style.display = 'none';
                    }
                });
                
                // Nếu sau 5 giây vẫn chưa nhận được sự kiện, thử kiểm tra dữ liệu trực tiếp
                setTimeout(() => {
                    if (window.cpuData && !document.getElementById('cpu').options.length > 1) {
                        console.log('Đã tải dữ liệu nhưng không nhận được sự kiện, điền dữ liệu vào dropdowns');
                        populateDropdowns();
                    }
                }, 5000);
                
            } catch (error) {
                console.error('Error during initialization:', error);
            }
        });
        
        // Đảm bảo updateConfigTableImages có thể truy cập toàn cục
        window.formatPrice = formatPrice;
    </script>

    <!-- Thêm script kết nối các component -->
    <script src="component-connector.js"></script>

    <!-- Event handlers script -->
    <script src="event-handlers.js"></script>

    <!-- Modern UI enhancements -->
    <script src="modern-ui.js"></script>

    <script>
    // Fix layout styling when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Ensure proper styling for navigation items
        const navItems = document.querySelectorAll('.nav-item, .step-item');
        if (navItems.length > 0) {
            navItems.forEach(item => {
                item.classList.add('fixed-layout');
            });
        }
        
        // Fix CPU selection items
        const cpuOptions = document.querySelectorAll('#intel-option, #amd-option');
        if (cpuOptions.length > 0) {
            cpuOptions.forEach(option => {
                option.classList.add('cpu-option');
            });
        }
        
        // Fix game cards
        const gameCards = document.querySelectorAll('.game-card');
        if (gameCards.length > 0) {
            gameCards.forEach(card => {
                card.classList.add('fixed-game-card');
            });
        }
        
        // Add wrapper for contact buttons if needed
        const contactButtons = document.querySelectorAll('a[href*="zalo"], a[href*="tel:"], a[href*="facebook"]');
        if (contactButtons.length > 0 && !document.querySelector('.contact-buttons')) {
            const firstButton = contactButtons[0];
            const parent = firstButton.parentNode;
            
            if (!parent.classList.contains('contact-buttons')) {
                const wrapper = document.createElement('div');
                wrapper.className = 'contact-buttons';
                
                contactButtons.forEach(button => {
                    wrapper.appendChild(button.cloneNode(true));
                });
                
                // Replace buttons with the wrapped version
                contactButtons.forEach(button => button.remove());
                parent.appendChild(wrapper);
            }
        }
        
        // Apply section styling to major containers
        const sections = document.querySelectorAll('.selection-section, .component-section, .budget-section');
        sections.forEach(section => {
            if (!section.classList.contains('styled-section')) {
                section.classList.add('styled-section');
            }
        });
        
        // Fix the header background
        const header = document.querySelector('header');
        if (header) {
            header.style.background = 'linear-gradient(135deg, #0053b4, #0275d8)';
        }
        
        // Add dark mode toggle if not present
        if (!document.querySelector('.dark-mode-toggle')) {
            const header = document.querySelector('header');
            if (header) {
                const toggle = document.createElement('div');
                toggle.className = 'dark-mode-toggle';
                toggle.innerHTML = '<i class="fas fa-moon"></i>';
                toggle.addEventListener('click', function() {
                    document.body.classList.toggle('dark-mode');
                    this.innerHTML = document.body.classList.contains('dark-mode') 
                        ? '<i class="fas fa-sun"></i>' 
                        : '<i class="fas fa-moon"></i>';
                });
                header.appendChild(toggle);
            }
        }
        
        // Make sure config table is visible
        const configTable = document.getElementById('config-table');
        if (configTable) {
            configTable.style.display = 'block';
            console.log('Config table display set to block on page load');
        }
        
        // Initialize buttons for showing modal
        const calculateButton = document.getElementById('calculate-button');
        const showConfigDetailsButton = document.getElementById('show-config-details');
        const summaryModal = document.getElementById('summary-modal');
        const closeModalBtn = document.querySelector('.close-modal');
        
        if (calculateButton && typeof window.calculateTotalPriceAndSummary === 'function') {
            calculateButton.addEventListener('click', function() {
                window.calculateTotalPriceAndSummary();
            });
        }
        
        if (showConfigDetailsButton && typeof window.calculateTotalPriceAndSummary === 'function') {
            showConfigDetailsButton.addEventListener('click', function() {
                window.calculateTotalPriceAndSummary();
            });
        }
        
        if (closeModalBtn && summaryModal) {
            closeModalBtn.addEventListener('click', function() {
                summaryModal.style.display = 'none';
                console.log('Closing modal via close button');
            });
            
            // Also close when clicking outside
            window.onclick = function(event) {
                if (event.target == summaryModal) {
                    summaryModal.style.display = 'none';
                    console.log('Closing modal via outside click');
                }
            };
        }
    });
    </script>

    <script src="./service-worker.js"></script>
    <script src="./component-compatibility.js"></script>
    
    <!-- Script to handle the show all config tables button -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize buttons for showing modal
            const calculateButton = document.getElementById('calculate-button');
            const showConfigDetailsButton = document.getElementById('show-config-details');
            const showAllConfigTablesButton = document.getElementById('show-all-config-tables');
            const summaryModal = document.getElementById('summary-modal');
            const closeModalBtn = document.querySelector('.close-modal');
            
            // Handler for Calculate button
            if (calculateButton) {
                calculateButton.addEventListener('click', function() {
                    console.log('Calculate button clicked - showing detailed configuration modal');
                    
                    // Calculate and update total price
                    if (typeof window.calculateTotalPriceAndSummary === 'function') {
                        window.calculateTotalPriceAndSummary();
                    }
                    
                    // Force show both tables
                    if (typeof window.forceShowComponentTable === 'function') {
                        window.forceShowComponentTable();
                    } else {
                        // Fallback to direct manipulation
                        const configTable = document.getElementById('config-table');
                        if (configTable) {
                            configTable.style.display = 'block';
                            configTable.style.visibility = 'visible';
                        }
                        
                        if (summaryModal) {
                            summaryModal.style.display = 'block';
                        }
                    }
                });
            }
            
            // Handler for "Show all config tables" button
            if (showAllConfigTablesButton) {
                showAllConfigTablesButton.addEventListener('click', function() {
                    console.log('Show all config tables button clicked');
                    
                    // Force show both configuration tables
                    if (typeof window.forceShowComponentTable === 'function') {
                        window.forceShowComponentTable();
                    } else {
                        console.error('forceShowComponentTable function not found, using fallback');
                        // Fallback if the function isn't available
                        // Show main config table
                        const configTable = document.getElementById('config-table');
                        if (configTable) {
                            configTable.style.display = 'block';
                            configTable.style.visibility = 'visible';
                            configTable.scrollIntoView({ behavior: 'smooth' });
                        }
                        
                        // Show the modal with detailed configuration
                        const summaryModal = document.getElementById('summary-modal');
                        if (summaryModal) {
                            summaryModal.style.display = 'block';
                            
                            // Make sure modal content is updated
                            if (typeof window.showConfigDetailModal === 'function') {
                                window.showConfigDetailModal();
                            } else if (typeof window.calculateTotalPriceAndSummary === 'function') {
                                window.calculateTotalPriceAndSummary();
                            }
                        }
                    }
                });
            }
            
            // Close modal handlers
            if (closeModalBtn && summaryModal) {
                closeModalBtn.addEventListener('click', function() {
                    summaryModal.style.display = 'none';
                    console.log('Closing modal via close button');
                });
                
                // Also close when clicking outside
                window.onclick = function(event) {
                    if (event.target == summaryModal) {
                        summaryModal.style.display = 'none';
                        console.log('Closing modal via outside click');
                    }
                };
            }
        });
    </script>

    <!-- Emergency config table fix - add near the top of the body -->
    <script>
    // IMMEDIATELY force config table visible
    (function() {
        // Direct DOM manipulation for config table
        function forceConfigTableVisible() {
            // Target the specific table with ID config-table
            const configTable = document.querySelector('#config-table, .config-table');
            if (configTable) {
                // Force display with aggressive !important style
                configTable.setAttribute('style', 'display: table !important; visibility: visible !important; opacity: 1 !important;');
                
                // Also add a class that we can target with CSS
                configTable.classList.add('force-visible');
                
                // Make all parent elements visible
                let parent = configTable.parentElement;
                while (parent) {
                    parent.setAttribute('style', 'display: block !important; visibility: visible !important; opacity: 1 !important;');
                    parent = parent.parentElement;
                }
                
                console.log('EMERGENCY: Forced config table visible');
            }
        }

        // Run immediately
        forceConfigTableVisible();
        
        // Also run after a small delay
        setTimeout(forceConfigTableVisible, 100);
        setTimeout(forceConfigTableVisible, 500);
        setTimeout(forceConfigTableVisible, 1000);
        
        // Also run continuously every 500ms
        setInterval(forceConfigTableVisible, 500);
        
        // Add a direct CSS rule
        const style = document.createElement('style');
        style.innerHTML = `
            #config-table, .config-table, .force-visible, 
            table[id="config-table"], table[class*="config-table"],
            div > table, .container > table {
                display: table !important;
                visibility: visible !important;
                opacity: 1 !important;
                border-collapse: collapse !important;
                width: 100% !important;
            }
        `;
        document.head.appendChild(style);
        
        // Also try direct element replacement
        document.addEventListener('DOMContentLoaded', function() {
            // Try to find the hidden table
            const hiddenTable = document.querySelector('#config-table, .config-table');
            if (hiddenTable && window.getComputedStyle(hiddenTable).display === 'none') {
                // Create a clone with forced visibility
                const clone = hiddenTable.cloneNode(true);
                clone.style.cssText = 'display: table !important; visibility: visible !important; opacity: 1 !important;';
                
                // Replace the original
                if (hiddenTable.parentNode) {
                    hiddenTable.parentNode.replaceChild(clone, hiddenTable);
                    console.log('EMERGENCY: Replaced hidden table with visible clone');
                }
            }
        });
    })();
    </script>

    <!-- Add a custom show button at the very top for config table -->
    <div style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 9999;">
        <button id="emergency-show-config" style="background-color: #ff0000; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
            HIỆN BẢNG CẤU HÌNH
        </button>
    </div>

    <script>
    // Emergency show config button handler
    document.addEventListener('DOMContentLoaded', function() {
        const emergencyButton = document.getElementById('emergency-show-config');
        if (emergencyButton) {
            emergencyButton.addEventListener('click', function() {
                // Aggressive approach to find and show config table
                const configTables = document.querySelectorAll('table');
                configTables.forEach(function(table) {
                    // Make all tables visible as a last resort
                    table.style.cssText = 'display: table !important; visibility: visible !important; opacity: 1 !important;';
                    
                    // Force all parent elements visible
                    let parent = table.parentElement;
                    while (parent) {
                        parent.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important;';
                        parent = parent.parentElement;
                    }
                });
                
                // Also try to force config table container visible
                const configContainer = document.querySelector('.config-table-container, .config-section, .config-container');
                if (configContainer) {
                    configContainer.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important;';
                }
                
                // Try to call all known show functions
                if (typeof window.showConfigDetailModal === 'function') window.showConfigDetailModal();
                if (typeof window.forceShowComponentTable === 'function') window.forceShowComponentTable();
                if (typeof window.forceShowConfigTables === 'function') window.forceShowConfigTables();
                if (typeof window.fixConfigTableDisplay === 'function') window.fixConfigTableDisplay();
                
                // Try to force the detailed config modal visible
                const detailModal = document.getElementById('component-detail-modal');
                if (detailModal) {
                    detailModal.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important;';
                    
                    // Show all tables inside it
                    const modalTables = detailModal.querySelectorAll('table');
                    modalTables.forEach(function(table) {
                        table.style.cssText = 'display: table !important; visibility: visible !important; opacity: 1 !important;';
                    });
                }
                
                console.log('EMERGENCY: Forced all tables visible');
            });
        }
    });
    </script>

    <!-- Script to automatically show modals on page load -->
    <script>
    // Force display of component-detail-modal
    window.addEventListener('load', function() {
        // First try the regular ways
        if (typeof window.showConfigDetailModal === 'function') {
            console.log('Calling showConfigDetailModal automatically');
            window.showConfigDetailModal();
        }
        
        // Then force direct visibility for modal
        setTimeout(function() {
            const modal = document.getElementById('component-detail-modal');
            if (modal) {
                console.log('Forcing component-detail-modal visible');
                modal.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important;';
                modal.classList.add('show');
                modal.classList.add('in');
                
                // Make backdrop visible too
                const backdrop = document.querySelector('.modal-backdrop');
                if (!backdrop) {
                    // Create a backdrop if it doesn't exist
                    const newBackdrop = document.createElement('div');
                    newBackdrop.className = 'modal-backdrop fade in';
                    newBackdrop.style.cssText = 'display: block !important; opacity: 0.5 !important;';
                    document.body.appendChild(newBackdrop);
                }
                
                // Show all tables inside the modal
                const tables = modal.querySelectorAll('table');
                tables.forEach(function(table) {
                    table.style.cssText = 'display: table !important; visibility: visible !important; opacity: 1 !important;';
                });
            }
        }, 1500); // Wait for 1.5 seconds after load
        
        // Also try to make the summary modal visible
        setTimeout(function() {
            const summaryModal = document.getElementById('summary-modal');
            if (summaryModal) {
                console.log('Forcing summary-modal visible');
                summaryModal.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important;';
            }
        }, 2000); // Wait for 2 seconds after load
    });
    </script>
</body>

</html>

<!-- At the end of the body tag, add this debug helper -->
<div id="debug-helper" style="position: fixed; bottom: 0; right: 0; background: rgba(0,0,0,0.7); color: white; padding: 10px; font-size: 12px; z-index: 9999; max-width: 400px; max-height: 300px; overflow: auto; display: none;">
    <div>
        Debug Status: 
        <button id="refresh-debug" style="background: #4CAF50; color: white; border: none; padding: 2px 5px; margin-left: 10px; cursor: pointer;">Refresh</button>
        <button id="close-debug" style="background: #f44336; color: white; border: none; padding: 2px 5px; margin-left: 5px; cursor: pointer;">Close</button>
    </div>
    <div id="debug-status"></div>
</div>

<script>
// Debug helper to check if tables are visible
function debugHelper() {
    const debugStatus = document.getElementById('debug-status');
    if (!debugStatus) return;
    
    const tables = document.querySelectorAll('table, #component-table, #configuration-table, .config-table');
    const calculateButtons = document.querySelectorAll('#calculate-btn, .calculate-btn, button[onclick*="showConfig"]');
    
    let status = '';
    
    // Check tables
    status += `<strong>Tables (${tables.length}):</strong><br>`;
    tables.forEach((table, index) => {
        if (index < 10) { // Show more tables to aid debugging
            const display = window.getComputedStyle(table).display;
            const visibility = window.getComputedStyle(table).visibility;
            const id = table.id || 'no-id';
            const className = table.className || 'no-class';
            status += `Table ${index}: ID=${id}, Class=${className}<br>`;
            status += `- display=${display}, visibility=${visibility}<br>`;
            if (display === 'none') {
                // If table is hidden, show parent chain to help debug
                let parent = table.parentElement;
                let parentChain = '';
                for (let i = 0; i < 3 && parent; i++) {
                    const parentDisplay = window.getComputedStyle(parent).display;
                    const parentId = parent.id || 'no-id';
                    const parentClass = parent.className || 'no-class';
                    parentChain += `Parent[${i}]: ID=${parentId}, Class=${parentClass}, display=${parentDisplay}<br>`;
                    parent = parent.parentElement;
                }
                status += `<span style="color: #ff5252;">${parentChain}</span>`;
            }
        }
    });
    
    // Check buttons
    status += `<br><strong>Buttons (${calculateButtons.length}):</strong><br>`;
    calculateButtons.forEach((button, index) => {
        if (index < 5) { // Show more buttons
            const id = button.id || 'no-id';
            const className = button.className || 'no-class';
            status += `Button ${index}: ID=${id}, Class=${className}, Text="${button.textContent || button.innerText || 'No text'}"<br>`;
        }
    });
    
    // Show function availability
    status += '<br><strong>Functions:</strong><br>';
    [
        'updateComponentTable',
        'showConfigDetailModal',
        'forceShowComponentTable',
        'fixConfigTableDisplay',
        'forceShowConfigTables',
        'calculateTotalPriceAndSummary'
    ].forEach(funcName => {
        const exists = typeof window[funcName] === 'function';
        status += `${funcName}: ${exists ? 'Available' : 'Not found'}<br>`;
    });
    
    // Get more detailed structure
    status += '<br><strong>Page Structure:</strong><br>';
    const configSections = document.querySelectorAll('.config-section, .component-selection, .component-selection-container');
    status += `Found ${configSections.length} configuration sections<br>`;
    
    // Check for modal visibility
    const modals = document.querySelectorAll('.modal, #configuration-detail-modal, .modal-content');
    status += `<br><strong>Modals (${modals.length}):</strong><br>`;
    modals.forEach((modal, index) => {
        if (index < 3) {
            const display = window.getComputedStyle(modal).display;
            const id = modal.id || 'no-id';
            const className = modal.className || 'no-class';
            status += `Modal ${index}: ID=${id}, Class=${className}, display=${display}<br>`;
        }
    });
    
    debugStatus.innerHTML = status;
}

// Run debug helper every 5 seconds (less frequent to reduce performance impact)
let debugInterval = setInterval(debugHelper, 5000);
debugHelper(); // Run immediately

// Add event to show/hide debug panel
document.getElementById('debug-helper').addEventListener('dblclick', function() {
    const debugStatus = document.getElementById('debug-status');
    debugStatus.style.display = debugStatus.style.display === 'none' ? 'block' : 'none';
});

// Add close button functionality
document.getElementById('close-debug').addEventListener('click', function() {
    const debugHelper = document.getElementById('debug-helper');
    if (debugHelper) {
        debugHelper.style.display = 'none';
    }
});

// Add refresh button functionality
document.getElementById('refresh-debug').addEventListener('click', function() {
    clearInterval(debugInterval);
    debugHelper(); // Run immediately
    debugInterval = setInterval(debugHelper, 5000); // Reset interval
});
</script>

<!-- Direct table display fix script - add at the very end -->
<script>
(function() {
    // Get all hidden elements and force them to be visible
    function forceElementsVisible() {
        // Find all elements with display:none style attribute
        document.querySelectorAll('[style*="display: none"], [style*="display:none"]').forEach(function(element) {
            // Check if it's a table or container we want to show (but NOT modals)
            if ((element.tagName === 'TABLE' || 
                element.id === 'component-table' || 
                element.id === 'configuration-table' ||
                element.id === 'config-table' ||
                element.className.includes('config-table') ||
                element.className.includes('table-responsive')) &&
                !element.className.includes('modal') && 
                !element.id.includes('modal')) {
                
                // Force display with inline style
                element.style.cssText = element.style.cssText.replace(/display\s*:\s*none/gi, 'display: table');
                element.style.display = 'table';
                element.style.visibility = 'visible';
                element.style.opacity = '1';
                
                console.log('Forced element visible:', element.tagName, element.id || element.className);
            }
            
            // Check if it's a container (but NOT a modal)
            if ((element.className.includes('container') || 
                element.className.includes('section') || 
                element.className.includes('table-container')) &&
                !element.className.includes('modal') && 
                !element.id.includes('modal')) {
                
                // Force display with inline style
                element.style.cssText = element.style.cssText.replace(/display\s*:\s*none/gi, 'display: block');
                element.style.display = 'block';
                element.style.visibility = 'visible';
                element.style.opacity = '1';
                
                console.log('Forced container visible:', element.tagName, element.id || element.className);
            }
        });
        
        // Make sure modals have proper close buttons
        document.querySelectorAll('.modal').forEach(function(modal) {
            // Don't force modals to be visible
            // Instead, make sure they have close buttons
            if (!modal.querySelector('.close-modal')) {
                const closeButton = document.createElement('button');
                closeButton.className = 'close-modal';
                closeButton.innerHTML = '&times;';
                closeButton.style.cssText = 'position: absolute; right: 10px; top: 10px; background: none; border: none; font-size: 24px; cursor: pointer;';
                
                closeButton.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
                
                // Add to modal if it has a header, or to the modal itself
                const header = modal.querySelector('.modal-header');
                if (header) {
                    header.appendChild(closeButton);
                } else {
                    modal.appendChild(closeButton);
                }
            }
        });
    }

    // Run after DOM is loaded, but not automatically - wait for user action
    document.addEventListener('DOMContentLoaded', function() {
        // Add a MutationObserver to handle any dynamically added config tables
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes && mutation.addedNodes.length > 0) {
                    // Check if any of the added nodes are tables
                    for (let i = 0; i < mutation.addedNodes.length; i++) {
                        const node = mutation.addedNodes[i];
                        if (node.tagName === 'TABLE' || 
                            (node.id && (node.id === 'config-table' || node.id === 'component-table')) ||
                            (node.className && node.className.includes('config-table'))) {
                            
                            // Make only this specific table visible
                            node.style.display = 'table';
                            node.style.visibility = 'visible';
                            node.style.opacity = '1';
                        }
                    }
                }
            });
        });
        
        // Start observing for table changes only
        observer.observe(document.body, { 
            childList: true, 
            subtree: true,
            attributes: true,
            attributeFilter: ['style', 'class']
        });
    });
})();
</script>

<!-- Add modal closing script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add close buttons to all modals
    function addCloseButtonsToModals() {
        document.querySelectorAll('.modal, #summary-modal, #component-detail-modal').forEach(function(modal) {
            // Add close button if it doesn't exist
            if (!modal.querySelector('.close') && !modal.querySelector('.close-modal')) {
                // Create close button
                const closeButton = document.createElement('button');
                closeButton.className = 'close-modal';
                closeButton.innerHTML = '&times;';
                closeButton.style.cssText = 'position: absolute; right: 15px; top: 15px; background: none; border: none; font-size: 28px; cursor: pointer; color: #000; z-index: 9999;';
                
                // Add click handler
                closeButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    modal.style.display = 'none';
                    
                    // Remove modal backdrop if it exists
                    const backdrop = document.querySelector('.modal-backdrop');
                    if (backdrop) {
                        backdrop.parentNode.removeChild(backdrop);
                    }
                    
                    // Remove modal-open class from body
                    document.body.classList.remove('modal-open');
                    document.body.style.overflow = '';
                    document.body.style.paddingRight = '';
                });
                
                // Insert close button
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    // Insert at the beginning of modal content
                    modalContent.insertBefore(closeButton, modalContent.firstChild);
                } else {
                    // No modal content container, add directly to modal
                    modal.appendChild(closeButton);
                }
                
                // Add ESC key handler
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && modal.style.display !== 'none') {
                        modal.style.display = 'none';
                        
                        // Remove modal backdrop
                        const backdrop = document.querySelector('.modal-backdrop');
                        if (backdrop) {
                            backdrop.parentNode.removeChild(backdrop);
                        }
                        
                        // Remove modal-open class from body
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                    }
                });
                
                // Also add click outside to close
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                        
                        // Remove modal backdrop
                        const backdrop = document.querySelector('.modal-backdrop');
                        if (backdrop) {
                            backdrop.parentNode.removeChild(backdrop);
                        }
                        
                        // Remove modal-open class from body
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                    }
                });
            }
        });
    }
    
    // Run when DOM is loaded
    addCloseButtonsToModals();
    
    // Also run whenever showConfigDetailModal is called
    const originalShowConfigDetailModal = window.showConfigDetailModal;
    if (typeof originalShowConfigDetailModal === 'function') {
        window.showConfigDetailModal = function() {
            // Call the original function
            originalShowConfigDetailModal.apply(this, arguments);
            
            // Add close buttons after the modal is shown
            setTimeout(addCloseButtonsToModals, 100);
        };
    }
    
    // Observe DOM for new modals
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes && mutation.addedNodes.length > 0) {
                // Check if any modals were added
                for (let i = 0; i < mutation.addedNodes.length; i++) {
                    const node = mutation.addedNodes[i];
                    if (node.classList && 
                        (node.classList.contains('modal') || 
                         node.id === 'summary-modal' || 
                         node.id === 'component-detail-modal')) {
                        addCloseButtonsToModals();
                    }
                }
            }
        });
    });
    
    // Start observing
    observer.observe(document.body, { 
        childList: true, 
        subtree: true
    });
});
</script>

